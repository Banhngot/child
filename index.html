<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Child Abuse Detection & Alert System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.24.7/babel.min.js"></script>
</head>
<body className="bg-gray-100 font-sans">
  <div id="root"></div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script>
    // Fallback for Chart.js if the primary CDN fails
    if (!window.Chart) {
      document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/4.4.1/chart.umd.min.js"></script>');
    }
  </script>
  <script type="text/babel">
    // Configuration
    const ABUSE_INDICATORS = {
      low: {
        keywords: ["scratch", "skin abrasion", "light scratch", "scratch"],
        bruisePercentage: { min: 0, max: 20 },
      },
      medium: {
        keywords: ["bruise", "swelling", "bruised", "swollen"],
        bruisePercentage: { min: 20, max: 50 },
      },
      serious: {
        keywords: ["bleeding", "hemorrhage", "broken bone", "large bruise", "abuse", "beating"],
        bruisePercentage: { min: 50, max: 100 },
      },
    };

    const USERS = [
      { username: "admin", role: "admin" },
      { username: "user", role: "user" },
      { username: "organization", role: "organization" },
    ];

    const DEMO_PASSWORD = "123";

    // Detection Logic
    function extractPercentage(content) {
      const percentMatch = content.match(/(\d+)\s*%/);
      return percentMatch ? parseInt(percentMatch[1], 10) : null;
    }

    function checkLevel(normalized, indicators) {
      const matchedKeywords = [];

      for (const keyword of indicators.keywords) {
        if (normalized.includes(keyword)) {
          matchedKeywords.push(keyword);
        }
      }

      const percentage = extractPercentage(normalized);
      if (percentage !== null && indicators.bruisePercentage && normalized.includes("bruise")) {
        const { min, max } = indicators.bruisePercentage;
        if (percentage > min && percentage <= max) {
          matchedKeywords.push(`bruise ${percentage}%`);
        }
      }

      if (matchedKeywords.length > 0) {
        return {
          found: true,
          keywords: matchedKeywords,
          reasoning: `Detected: ${matchedKeywords.join(", ")}`,
        };
      }

      return {
        found: false,
        keywords: [],
        reasoning: "",
      };
    }

    function detectAbuseLevel(content) {
      const normalized = content.trim().toLowerCase();

      const seriousMatch = checkLevel(normalized, ABUSE_INDICATORS.serious);
      if (seriousMatch.found) {
        return {
          level: "serious",
          matchedKeywords: seriousMatch.keywords,
          reasoning: seriousMatch.reasoning,
        };
      }

      const mediumMatch = checkLevel(normalized, ABUSE_INDICATORS.medium);
      if (mediumMatch.found) {
        return {
          level: "medium",
          matchedKeywords: mediumMatch.keywords,
          reasoning: mediumMatch.reasoning,
        };
      }

      const lowMatch = checkLevel(normalized, ABUSE_INDICATORS.low);
      if (lowMatch.found) {
        return {
          level: "low",
          matchedKeywords: lowMatch.keywords,
          reasoning: lowMatch.reasoning,
        };
      }

      return {
        level: "low",
        matchedKeywords: [],
        reasoning: "No signs of abuse detected",
      };
    }

    // Error Boundary Component
    class ErrorBoundary extends React.Component {
      state = { hasError: false, error: null };

      static getDerivedStateFromError(error) {
        return { hasError: true, error };
      }

      render() {
        if (this.state.hasError) {
          return (
            <div className="text-red-600 p-4 text-center">
              An error occurred: {this.state.error?.message || "Unknown"}. Please try again.
            </div>
          );
        }
        return this.props.children;
      }
    }

    function App() {
      const [user, setUser] = React.useState(null);
      const [loginErr, setLoginErr] = React.useState("");
      const [username, setUsername] = React.useState("");
      const [password, setPassword] = React.useState("");
      const [cases, setCases] = React.useState([]);
      const [caseType, setCaseType] = React.useState("case_note");
      const [childName, setChildName] = React.useState("");
      const [childAge, setChildAge] = React.useState("");
      const [childGender, setChildGender] = React.useState("male");
      const [region, setRegion] = React.useState("Northern");
      const [origin, setOrigin] = React.useState("Rural");
      const [content, setContent] = React.useState("");
      const [editingCaseId, setEditingCaseId] = React.useState(null);

      const handleLogin = (e) => {
        e.preventDefault();
        const found = USERS.find((u) => u.username === username && password === DEMO_PASSWORD);
        if (found) {
          setUser(found);
          setLoginErr("");
        } else {
          setLoginErr("Incorrect username or password");
        }
      };

      // Auto-fill logic for organization role
      React.useEffect(() => {
        if (user?.role === "organization" && (caseType === "school_report" || caseType === "medical_document") && childName && childAge && childGender) {
          const ageNum = parseInt(childAge, 10);
          if (!isNaN(ageNum)) {
            const matchingCases = cases.filter(
              (c) =>
                (c.createdBy === "user" || c.createdBy === "admin") &&
                c.childName.toLowerCase() === childName.trim().toLowerCase() &&
                c.childAge === ageNum &&
                c.childGender === childGender
            ).sort((a, b) => b.id - a.id);

            if (matchingCases.length > 0) {
              const latestMatch = matchingCases[0];
              setRegion(latestMatch.region || "Northern");
              setOrigin(latestMatch.origin || "Rural");
              setContent(latestMatch.content || "");
              alert(`Extracted information from history: Region - ${latestMatch.region}, Origin - ${latestMatch.origin}, Content - ${latestMatch.content.substring(0, 50)}...`);
            } else {
              setRegion("Northern");
              setOrigin("Rural");
              setContent("");
            }
          }
        } else {
          setRegion("Northern");
          setOrigin("Rural");
          setContent("");
        }
      }, [caseType, childName, childAge, childGender, user, cases]);

      const handleAddCase = (e) => {
        e.preventDefault();
        if (!childName.trim() || !childAge.trim() || !content.trim() || !region || !origin) {
          alert("Child name, age, region, origin, and content cannot be empty");
          return;
        }

        const ageNum = parseInt(childAge, 10);
        if (isNaN(ageNum) || ageNum <= 0) {
          alert("Age must be a valid positive number");
          return;
        }

        if (editingCaseId && user.role === "user") {
          alert("You do not have permission to edit data.");
          return;
        }

        const detection = detectAbuseLevel(content);

        const newCase = {
          id: editingCaseId || Date.now(),
          type: caseType,
          childName: childName.trim(),
          childAge: ageNum,
          childGender,
          region,
          origin,
          content,
          extracted: detection.reasoning,
          date: new Date().toISOString().slice(0, 10),
          prediction: detection.level,
          notified: detection.level === "serious",
          matchedKeywords: detection.matchedKeywords,
          createdBy: editingCaseId ? cases.find((c) => c.id === editingCaseId)?.createdBy || user.role : user.role,
          lastEditedBy: editingCaseId ? user.role : undefined,
        };

        const existingCases = cases.filter(
          (c) =>
            c.childName.toLowerCase() === childName.trim().toLowerCase() &&
            c.childAge === ageNum &&
            c.childGender === childGender &&
            c.id !== editingCaseId
        );

        if (existingCases.length > 0) {
          let message = `Duplicate information detected for child "${childName.trim()}" (Age: ${ageNum}, Gender: ${
            childGender === "male" ? "Male" : childGender === "female" ? "Female" : "Other"
          }). Previous cases:\n`;
          existingCases.forEach((c, index) => {
            message += `\nCase ${index + 1} (${c.date}):\n`;
            message += `Type: ${c.type}\n`;
            message += `Content: ${c.content}\n`;
            message += `Extracted: ${c.extracted}\n`;
            message += `Prediction: ${
              c.prediction === "serious" ? "Serious" : c.prediction === "medium" ? "Medium" : "Low"
            }\n`;
            message += `Matched Keywords: ${c.matchedKeywords.length > 0 ? c.matchedKeywords.join(", ") : "-"}\n`;
          });
          alert(message);
        } else {
          alert(editingCaseId ? `Updated information for child "${childName.trim()}".` : `Added new information for child "${childName.trim()}".`);
        }

        if (editingCaseId) {
          setCases((prev) => prev.map((c) => (c.id === editingCaseId ? newCase : c)));
        } else {
          setCases((prev) => [newCase, ...prev]);
        }

        setChildName("");
        setChildAge("");
        setChildGender("male");
        setRegion("Northern");
        setOrigin("Rural");
        setContent("");
        setCaseType("case_note");
        setEditingCaseId(null);
      };

      const handleEditCase = (caseData) => {
        if (user.role === "user") {
          alert("You do not have permission to edit data.");
          return;
        }
        setEditingCaseId(caseData.id);
        setCaseType(caseData.type);
        setChildName(caseData.childName);
        setChildAge(caseData.childAge.toString());
        setChildGender(caseData.childGender);
        setRegion(caseData.region || "Northern");
        setOrigin(caseData.origin || "Rural");
        setContent(caseData.content);
      };

      const handleDeleteCase = (id) => {
        if (user.role === "user") {
          alert("You do not have permission to delete data.");
          return;
        }
        if (window.confirm("Are you sure you want to delete this case?")) {
          setCases((prev) => prev.filter((c) => c.id !== id));
          alert("Case deleted.");
        }
      };

      const stats = React.useMemo(() => {
        const filteredCases =
          user?.role === "organization"
            ? cases
            : user?.role === "user"
            ? cases.filter((c) => c.createdBy === "user" && !c.lastEditedBy)
            : cases.filter((c) => c.createdBy !== "organization" && c.lastEditedBy !== "organization");

        const total = filteredCases.length;
        const serious = filteredCases.filter((c) => c.prediction === "serious").length;
        const medium = filteredCases.filter((c) => c.prediction === "medium").length;
        const low = filteredCases.filter((c) => c.prediction === "low").length;
        const hasSerious = filteredCases.some((c) => c.prediction === "serious" && c.notified);

        const genderCounts = { male: 0, female: 0, other: 0 };
        const regionCounts = { "Northern": 0, "Central": 0, "Southern": 0 };
        const originCounts = { "Rural": 0, "Urban": 0 };
        const dateCounts = {};

        filteredCases.forEach((c) => {
          genderCounts[c.childGender] = (genderCounts[c.childGender] || 0) + 1;
          regionCounts[c.region] = (regionCounts[c.region] || 0) + 1;
          originCounts[c.origin] = (originCounts[c.origin] || 0) + 1;
          dateCounts[c.date] = (dateCounts[c.date] || 0) + 1;
        });

        return { total, serious, medium, low, hasSerious, genderCounts, regionCounts, originCounts, dateCounts };
      }, [cases, user]);

      // Chart refs
      const genderChartRef = React.useRef(null);
      const regionChartRef = React.useRef(null);
      const originChartRef = React.useRef(null);
      const trendChartRef = React.useRef(null);

      React.useEffect(() => {
        let genderChart, regionChart, originChart, trendChart;

        if (window.Chart) {
          const hasData = stats.total > 0;

          // Gender Pie Chart
          if (genderChartRef.current) {
            genderChart = new window.Chart(genderChartRef.current, {
              type: "pie",
              data: {
                labels: ["Male", "Female", "Other"],
                datasets: [{
                  data: hasData ? [
                    stats.genderCounts.male,
                    stats.genderCounts.female,
                    stats.genderCounts.other
                  ] : [1],
                  backgroundColor: hasData ? ["#2563eb", "#db2777", "#6b7280"] : ["#e5e7eb"],
                }],
              },
              options: {
                responsive: true,
                plugins: {
                  legend: { position: "top" },
                  title: { display: true, text: "Distribution by Gender" },
                  tooltip: { enabled: hasData },
                  datalabels: { display: hasData }
                }
              }
            });
          }

          // Region Pie Chart
          if (regionChartRef.current) {
            regionChart = new window.Chart(regionChartRef.current, {
              type: "pie",
              data: {
                labels: ["Northern", "Central", "Southern"],
                datasets: [{
                  data: hasData ? [
                    stats.regionCounts["Northern"],
                    stats.regionCounts["Central"],
                    stats.regionCounts["Southern"]
                  ] : [1],
                  backgroundColor: hasData ? ["#16a34a", "#ca8a04", "#dc2626"] : ["#e5e7eb"],
                }],
              },
              options: {
                responsive: true,
                plugins: {
                  legend: { position: "top" },
                  title: { display: true, text: "Distribution by Region" },
                  tooltip: { enabled: hasData },
                  datalabels: { display: hasData }
                }
              }
            });
          }

          // Origin Pie Chart
          if (originChartRef.current) {
            originChart = new window.Chart(originChartRef.current, {
              type: "pie",
              data: {
                labels: ["Rural", "Urban"],
                datasets: [{
                  data: hasData ? [
                    stats.originCounts["Rural"],
                    stats.originCounts["Urban"]
                  ] : [1],
                  backgroundColor: hasData ? ["#059669", "#7c3aed"] : ["#e5e7eb"],
                }],
              },
              options: {
                responsive: true,
                plugins: {
                  legend: { position: "top" },
                  title: { display: true, text: "Distribution by Origin" },
                  tooltip: { enabled: hasData },
                  datalabels: { display: hasData }
                }
              }
            });
          }

          // Trend Line Chart
          if (trendChartRef.current) {
            const sortedDates = Object.keys(stats.dateCounts).sort();
            trendChart = new window.Chart(trendChartRef.current, {
              type: "line",
              data: {
                labels: sortedDates.length > 0 ? sortedDates : ["No data"],
                datasets: [{
                  label: "Number of Cases",
                  data: sortedDates.length > 0 ? sortedDates.map(date => stats.dateCounts[date]) : [0],
                  borderColor: "#dc2626",
                  backgroundColor: "#dc2626",
                  fill: false,
                  tension: 0.1
                }],
              },
              options: {
                responsive: true,
                plugins: {
                  legend: { position: "top" },
                  title: { display: true, text: "Trend of Cases Over Time" }
                },
                scales: {
                  x: { title: { display: true, text: "Date" } },
                  y: { title: { display: true, text: "Number of Cases" }, beginAtZero: true }
                }
              }
            });
          }
        }

        return () => {
          if (genderChart) genderChart.destroy();
          if (regionChart) regionChart.destroy();
          if (originChart) originChart.destroy();
          if (trendChart) trendChart.destroy();
        };
      }, [stats]);

      const displayedCases =
        user?.role === "organization"
          ? cases
          : user?.role === "user"
          ? cases.filter((c) => c.createdBy === "user" && !c.lastEditedBy)
          : cases.filter((c) => c.createdBy !== "organization" && c.lastEditedBy !== "organization");

      return (
        <ErrorBoundary>
          {user ? (
            <div className="min-h-screen bg-gray-100">
              <header className="bg-blue-600 text-white p-4 shadow-md">
                <div className="max-w-7xl mx-auto flex items-center justify-between">
                  <div className="flex items-center">
                    <svg className="w-8 h-8 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 0118 0z"></path>
                    </svg>
                    <h1 className="text-xl font-bold">Child Abuse Detection & Alert System</h1>
                  </div>
                  <div>
                    Hello, <b>{user.username}</b> ({user.role})
                    <button
                      onClick={() => setUser(null)}
                      className="ml-4 bg-blue-700 text-white px-4 py-2 rounded-md hover:bg-blue-800 transition"
                    >
                      Logout
                    </button>
                  </div>
                </div>
              </header>

              <main className="max-w-7xl mx-auto p-6">
                <div className="flex flex-col lg:flex-row gap-8">
                  <div className="flex-1 bg-white p-6 rounded-lg shadow-md">
                    <h3 className="text-lg font-semibold text-blue-600 mb-4">
                      {editingCaseId ? "Edit Data" : "Enter New Data"}
                    </h3>
                    <div>
                      <label htmlFor="type" className="block text-sm font-medium text-gray-700 mb-2">
                        Document Type:
                      </label>
                      <select
                        id="type"
                        value={caseType}
                        onChange={(e) => setCaseType(e.target.value)}
                        className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"
                      >
                        <option value="case_note">Case Note</option>
                        <option value="school_report">School Report</option>
                        <option value="medical_document">Medical Document</option>
                      </select>

                      <label htmlFor="childName" className="block text-sm font-medium text-gray-700 mb-2">
                        Child Name:
                      </label>
                      <input
                        id="childName"
                        value={childName}
                        onChange={(e) => setChildName(e.target.value)}
                        placeholder="Enter child name"
                        className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"
                      />

                      <label htmlFor="childAge" className="block text-sm font-medium text-gray-700 mb-2">
                        Child Age:
                      </label>
                      <input
                        id="childAge"
                        type="number"
                        value={childAge}
                        onChange={(e) => setChildAge(e.target.value)}
                        placeholder="Enter child age"
                        className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"
                      />

                      <label htmlFor="childGender" className="block text-sm font-medium text-gray-700 mb-2">
                        Child Gender:
                      </label>
                      <select
                        id="childGender"
                        value={childGender}
                        onChange={(e) => setChildGender(e.target.value)}
                        className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"
                      >
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                      </select>

                      <label htmlFor="region" className="block text-sm font-medium text-gray-700 mb-2">
                        Region:
                      </label>
                      <select
                        id="region"
                        value={region}
                        onChange={(e) => setRegion(e.target.value)}
                        className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"
                      >
                        <option value="Northern">Northern</option>
                        <option value="Central">Central</option>
                        <option value="Southern">Southern</option>
                      </select>

                      <label htmlFor="origin" className="block text-sm font-medium text-gray-700 mb-2">
                        Origin:
                      </label>
                      <select
                        id="origin"
                        value={origin}
                        onChange={(e) => setOrigin(e.target.value)}
                        className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"
                      >
                        <option value="Rural">Rural</option>
                        <option value="Urban">Urban</option>
                      </select>

                      <label htmlFor="content" className="block text-sm font-medium text-gray-700 mb-2">
                        Content:
                      </label>
                      <textarea
                        id="content"
                        value={content}
                        onChange={(e) => setContent(e.target.value)}
                        placeholder="Enter content..."
                        className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4 h-32"
                      />

                      <button
                        onClick={handleAddCase}
                        className="w-full bg-blue-600 text-white p-3 rounded-md hover:bg-blue-700 transition"
                      >
                        {editingCaseId ? "Update" : "Submit and Analyze"}
                      </button>
                      {editingCaseId && (user.role === "admin" || user.role === "organization") && (
                        <button
                          onClick={() => {
                            setChildName("");
                            setChildAge("");
                            setChildGender("male");
                            setRegion("Northern");
                            setOrigin("Rural");
                            setContent("");
                            setCaseType("case_note");
                            setEditingCaseId(null);
                          }}
                          className="w-full bg-gray-300 text-gray-700 p-3 rounded-md hover:bg-gray-400 transition mt-2"
                        >
                          Cancel Edit
                        </button>
                      )}
                    </div>

                    {stats.hasSerious && (
                      <div className="mt-4 p-4 bg-red-50 border border-red-500 rounded-md text-red-600 font-semibold">
                        ⚠️ Serious case detected! Alert sent to relevant organization.
                      </div>
                    )}
                  </div>

                  <div className="flex-1 bg-white p-6 rounded-lg shadow-md">
                    <h3 className="text-lg font-semibold text-blue-600 mb-4">Statistics & Charts</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div className="p-4 bg-gray-50 rounded-md">
                        <h4 className="text-md font-semibold text-gray-700">Overview</h4>
                        <p className="mt-2">Total Cases: <b>{stats.total}</b></p>
                        <p className="mt-1">Serious: <b className="text-red-600">{stats.serious}</b></p>
                        <p className="mt-1">Medium: <b className="text-orange-600">{stats.medium}</b></p>
                        <p className="mt-1">Low: <b className="text-green-600">{stats.low}</b></p>
                      </div>
                      <div className="p-4 bg-gray-50 rounded-md">
                        <h4 className="text-md font-semibold text-gray-700">Gender Distribution Chart</h4>
                        <canvas ref={genderChartRef} className="mt-2"></canvas>
                      </div>
                      <div className="p-4 bg-gray-50 rounded-md">
                        <h4 className="text-md font-semibold text-gray-700">Region Distribution Chart</h4>
                        <canvas ref={regionChartRef} className="mt-2"></canvas>
                      </div>
                      <div className="p-4 bg-gray-50 rounded-md">
                        <h4 className="text-md font-semibold text-gray-700">Origin Distribution Chart</h4>
                        <canvas ref={originChartRef} className="mt-2"></canvas>
                      </div>
                      <div className="p-4 bg-gray-50 rounded-md md:col-span-2">
                        <h4 className="text-md font-semibold text-gray-700">Trend Over Time Chart</h4>
                        <canvas ref={trendChartRef} className="mt-2"></canvas>
                      </div>
                    </div>
                    {!window.Chart && (
                      <p className="text-red-600 text-center mt-4">
                        Error: Unable to load chart library. Please check your network, disable ad blockers, or try again later.
                      </p>
                    )}
                    {stats.total === 0 && window.Chart && (
                      <p className="text-gray-500 text-center mt-4">No data available to display charts.</p>
                    )}
                  </div>
                </div>

                {(user.role === "admin" || user.role === "organization") && (
                  <>
                    <h3 className="text-lg font-semibold text-blue-600 mt-8">Case History</h3>
                    <div className="overflow-x-auto mt-4">
                      <table className="w-full bg-white rounded-lg shadow-md">
                        <thead className="bg-gray-200">
                          <tr>
                            {user.role === "admin" || (user.role === "organization" && displayedCases.some(c => c.type === "school_report" && (c.createdBy === "user" || c.createdBy === "admin"))) ? (
                              <>
                                <th className="p-3 text-left text-sm font-semibold text-gray-700">Type</th>
                                <th className="p-3 text-left text-sm font-semibold text-gray-700">Child Name</th>
                                <th className="p-3 text-left text-sm font-semibold text-gray-700">Age</th>
                                <th className="p-3 text-left text-sm font-semibold text-gray-700">Gender</th>
                                <th className="p-3 text-left text-sm font-semibold text-gray-700">Region</th>
                                <th className="p-3 text-left text-sm font-semibold text-gray-700">Origin</th>
                                <th className="p-3 text-left text-sm font-semibold text-gray-700">Content</th>
                                <th className="p-3 text-left text-sm font-semibold text-gray-700">Extracted (NLP)</th>
                                <th className="p-3 text-left text-sm font-semibold text-gray-700">Matched Keywords</th>
                                <th className="p-3 text-left text-sm font-semibold text-gray-700">AI Prediction</th>
                                <th className="p-3 text-left text-sm font-semibold text-gray-700">Date</th>
                                <th className="p-3 text-left text-sm font-semibold text-gray-700">Actions</th>
                              </>
                            ) : (
                              <>
                                <th className="p-3 text-left text-sm font-semibold text-gray-700">Child Name</th>
                                <th className="p-3 text-left text-sm font-semibold text-gray-700">AI Prediction</th>
                                <th className="p-3 text-left text-sm font-semibold text-gray-700">Date</th>
                                <th className="p-3 text-left text-sm font-semibold text-gray-700">Actions</th>
                              </>
                            )}
                          </tr>
                        </thead>
                        <tbody>
                          {displayedCases.length === 0 ? (
                            <tr>
                              <td
                                colSpan={user.role === "admin" || displayedCases.some(c => c.type === "school_report" && (c.createdBy === "user" || c.createdBy === "admin")) ? 12 : 4}
                                className="p-3 text-center text-gray-500"
                              >
                                No data available
                              </td>
                            </tr>
                          ) : (
                            displayedCases.map((c) => (
                              <tr key={c.id} className="border-b">
                                {user.role === "admin" || (user.role === "organization" && c.type === "school_report" && (c.createdBy === "user" || c.createdBy === "admin")) ? (
                                  <>
                                    <td className="p-3">{c.type}</td>
                                    <td className="p-3">{c.childName}</td>
                                    <td className="p-3">{c.childAge}</td>
                                    <td className="p-3">
                                      {c.childGender === "male" ? "Male" : c.childGender === "female" ? "Female" : "Other"}
                                    </td>
                                    <td className="p-3">{c.region}</td>
                                    <td className="p-3">{c.origin}</td>
                                    <td className="p-3 max-w-xs">{c.content.substring(0, 50)}{c.content.length > 50 ? "..." : ""}</td>
                                    <td className="p-3">{c.extracted}</td>
                                    <td className="p-3">
                                      {c.matchedKeywords.length > 0 ? c.matchedKeywords.join(", ") : "-"}
                                    </td>
                                    <td
                                      className={`p-3 ${
                                        c.prediction === "serious"
                                          ? "text-red-600 font-semibold"
                                          : c.prediction === "medium"
                                          ? "text-orange-600"
                                          : "text-green-600"
                                      }`}
                                    >
                                      {c.prediction === "serious"
                                        ? "Serious"
                                        : c.prediction === "medium"
                                        ? "Medium"
                                        : "Low"}
                                    </td>
                                    <td className="p-3">{c.date}</td>
                                    <td className="p-3">
                                      <button
                                        onClick={() => handleEditCase(c)}
                                        className="bg-blue-600 text-white px-3 py-1 rounded-md hover:bg-blue-700 transition mr-2"
                                      >
                                        Edit
                                      </button>
                                      <button
                                        onClick={() => handleDeleteCase(c.id)}
                                        className="bg-red-600 text-white px-3 py-1 rounded-md hover:bg-red-700 transition"
                                      >
                                        Delete
                                      </button>
                                    </td>
                                  </>
                                ) : (
                                  <>
                                    <td className="p-3">{c.childName}</td>
                                    <td
                                      className={`p-3 ${
                                        c.prediction === "serious"
                                          ? "text-red-600 font-semibold"
                                          : c.prediction === "medium"
                                          ? "text-orange-600"
                                          : "text-green-600"
                                      }`}
                                    >
                                      {c.prediction === "serious"
                                        ? "Serious"
                                        : c.prediction === "medium"
                                        ? "Medium"
                                        : "Low"}
                                    </td>
                                    <td className="p-3">{c.date}</td>
                                    <td className="p-3">
                                      <button
                                        onClick={() => handleEditCase(c)}
                                        className="bg-blue-600 text-white px-3 py-1 rounded-md hover:bg-blue-700 transition mr-2"
                                      >
                                        Edit
                                      </button>
                                      <button
                                        onClick={() => handleDeleteCase(c.id)}
                                        className="bg-red-600 text-white px-3 py-1 rounded-md hover:bg-red-700 transition"
                                      >
                                        Delete
                                      </button>
                                    </td>
                                  </>
                                )}
                              </tr>
                            ))
                          )}
                        </tbody>
                      </table>
                    </div>
                  </>
                )}

                <div className="mt-8 p-6 bg-blue-50 rounded-lg">
                  <b className="text-blue-600">Usage Guide:</b>
                  <ul className="mt-2 list-disc list-inside text-gray-700">
                    <li><b>Low:</b> scratches, light scratches, bruises under 20%</li>
                    <li><b>Medium:</b> bruises, swelling, bruises 20-50%</li>
                    <li><b>Serious:</b> bleeding, abuse, beating, bruises over 50%</li>
                  </ul>
                  <div className="mt-2 italic text-gray-600">
                    Example: "Child has a 60% bruise" will be classified as serious
                  </div>
                </div>
              </main>

              <footer className="bg-blue-600 text-white p-4 mt-8">
                <div className="max-w-7xl mx-auto text-center">
                  <p>© 2025 Child Protection System. All rights reserved.</p>
                  <p className="mt-2">This application supports the detection and reporting of child abuse cases to protect children's future.</p>
                </div>
              </footer>
            </div>
          ) : (
            <div className="min-h-screen flex items-center justify-center bg-gray-100">
              <div className="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
                <h2 className="text-2xl font-bold text-blue-600 mb-6 text-center">Login</h2>
                <div>
                  <label htmlFor="username" className="block text-sm font-medium text-gray-700 mb-2">
                    Username:
                  </label>
                  <input
                    id="username"
                    value={username}
                    onChange={(e) => setUsername(e.target.value)}
                    placeholder="Enter username"
                    className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"
                  />
                  <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-2">
                    Password:
                  </label>
                  <input
                    id="password"
                    type="password"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    placeholder="Enter password"
                    className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"
                  />
                  <button
                    onClick={handleLogin}
                    className="w-full bg-blue-600 text-white p-3 rounded-md hover:bg-blue-700 transition"
                  >
                    Login
                  </button>
                </div>
                {loginErr && (
                  <div className="text-red-500 font-bold mt-4 text-center">
                    {loginErr}
                  </div>
                )}
                <div className="mt-6 p-4 bg-gray-50 rounded-md">
                  <div className="mb-2">
                    Username: <b>admin</b>, <b>user</b>, or <b>organization</b>
                  </div>
                  <div>
                    Password: <b>123</b>
                  </div>
                </div>
              </div>
            </div>
          )}
        </ErrorBoundary>
      );
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>